$(function(){$('.theme-option-title').attr('style','--i-width: '+$('.theme-option-title>span>i').width()+'px');$('.box-base').wrapAll('<div class="yoniu-box box-about-base active"></div>');$('.box-nav').wrapAll('<div class="yoniu-box box-about-nav"></div>');$('.box-list').wrapAll('<div class="yoniu-box box-about-list"></div>');$('.box-speed').wrapAll('<div class="yoniu-box box-about-speed"></div>');$('.box-sidebar').wrapAll('<div class="yoniu-box box-about-sidebar"></div>');$('.box-diy').wrapAll('<div class="yoniu-box box-about-diy"></div>');$('.box-key').wrapAll('<div class="yoniu-box box-about-key"></div>');$('form:not(.login-form):not(.reg-form)').append($('.box-about-about'));$('.yoniu-box').each(function(i){$(this).attr('style','--max-height:'+$(this).height()+'px;');$(this).addClass('hide')});if($("#login-container").length>0){$(".theme-option-nav").hide()}$.ajax({type:'get',url:'https://cdn.jsdelivr.net/gh/yoniu/twitter@master/beta.md',dataType:'text',success:function(e){$('.box-about-about').attr('style','visibility: hidden;opacity: 0;--max-height: unset;');$('.box-about-about').removeClass('hide');$('.box-about-about').addClass('active');$('.box-about-about').addClass('hide');var patt=/\[updata_log]([\s\S]*)\[\/updata_log]/g;var ret=e.match(patt).toString();ret=ret.replace(/\[updata_log]([\s\S]*)\[\/updata_log]/g,'$1');var patt2=/\[version]([\s\S]*)\[\/version]/g;var ret2=e.match(patt2).toString();ret2=ret2.replace(/\[version]([\s\S]*)\[\/version]/g,'$1');$('.box-about-about').find('.updataDetail').append(ret);$('.newVersion').html('v'+ret2);void $('.box-about-about').offsetWidth;$('.box-about-about').attr('style','visibility: visible;opacity: 1;--max-height: '+$('.box-about-about').height()+'px;');$('.box-about-about').removeClass('active')},error:function(){$('.box-about-about').html('<h3>获取信息失败</h3>')}});$("form.login-form").submit(function(){$x=$("form.login-form").serializeArray();$(this).find("button").hide();$x.push({name:"action",value:"doLogin"});$.ajax({type:'post',url:window.location.href,data:$x,dataType:'text',success:function(e){$r=$(e).find("#doAction").html();if($r=="true"){alert("登录成功！");window.location.reload()}else{alert($r);window.location.reload()}}});return false});$("form.reg-form").submit(function(){$x=$("form.reg-form").serializeArray();$(this).find("button").hide();$x.push({name:"action",value:"doRegister"});$.ajax({type:'post',url:window.location.href,data:$x,dataType:'text',success:function(e){$r=$(e).find("#doAction").html();if($r=="true"){alert("注册成功！");window.location.replace("./options-theme.php?action=login")}else{alert($r);window.location.reload()}}});return false});$('.theme-option-a').click(function(){$('.theme-option-a.active').removeClass('active');$('.yoniu-box.active').addClass('hide');$('.yoniu-box.active').removeClass('active');$(this).addClass('active');$('.'+$(this).data('target')).addClass('active');return false});var link_count=0;var nav_count=0;var link_text=$('textarea[name=friends]').val();var nav_text=$('textarea[name=option_nav]').val();$('textarea[name=friends]').after('<div><button class="setting-show">快速设置</button></div>');$('textarea[name=option_nav]').after('<div><button class="setting-nav-show">快速设置</button></div>');$('textarea[name=friends]').bind('input propertychange',function(){link_text=$('textarea[name=friends]').val()});$('textarea[name=option_nav]').bind('input propertychange',function(){nav_text=$('textarea[name=option_nav]').val()});$('.setting-show').click(function(){link_text=$('textarea[name=friends]').val();setForm();$('#yoniu-setting').removeClass('nav-setting');$('#yoniu-setting').addClass('show');$('#yoniu-setting').addClass('friends-setting');$('.setting-title span').html('友链设置');return false});$('.setting-nav-show').click(function(){nav_text=$('textarea[name=option_nav]').val();setNavForm();$('#yoniu-setting').removeClass('friends-setting');$('#yoniu-setting').addClass('show');$('#yoniu-setting').addClass('nav-setting');$('.setting-title span').html('导航设置');return false});$('.setting-title>svg').click(function(){$('#yoniu-setting').toggleClass('show')});$('.setting-add').click(function(){if($('#yoniu-setting').hasClass('friends-setting')){$('form[name=setting]').append('<li data-id="'+link_count+'"><input type="text" name="title'+link_count+'" placeholder="链接标题"/><input type="text" name="des'+link_count+'" placeholder="链接描述"/><input type="text" name="url'+link_count+'" placeholder="链接"/><input type="text" name="avatar'+link_count+'" placeholder="头像链接"/><select name="show'+link_count+'"><option value ="true">首页显示</option><option value ="false">首页不显示</option></select><svg t="1621246843640" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6437" width="200" height="200"><path d="M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z" p-id="6438"></path></svg></li>');link_count++}else{$('form[name=setting]').append('<li data-id="'+nav_count+'"><input type="text" name="title'+nav_count+'" placeholder="链接标题"/><input type="text" name="url'+nav_count+'" placeholder="链接"/><input type="text" name="fa'+nav_count+'" placeholder="fa图标名"/><select name="target'+nav_count+'"><option value ="true">新窗口打开</option><option value ="false">非新窗口打开</option></select><svg t="1621246843640" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6437" width="200" height="200"><path d="M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z" p-id="6438"></path></svg></li>');nav_count++}});$('.setting-save').click(function(){if($('#yoniu-setting').hasClass('friends-setting')){var link_setting=$('form[name=setting]').serializeArray();var return_text='';for(var i=0;i<link_count;i++){if($('input[name=title'+i+']').length>0){return_text+=$('input[name=title'+i+']').val();if($('input[name=des'+i+']').val()!=''&&$('input[name=des'+i+']').length>0){return_text+='+'+$('input[name=url'+i+']').val();return_text+='+'+$('input[name=des'+i+']').val();return_text+='+'+$('select[name=show'+i+']').val();if($('input[name=avatar'+i+']').val()!=''){return_text+='+'+$('input[name=avatar'+i+']').val()}}if(i<link_count-1){return_text+='\n'}}}$('textarea[name=friends]').val(return_text)}else{var nav_setting=$('form[name=setting]').serializeArray();var return_text='';for(var i=0;i<nav_count;i++){if($('input[name=title'+i+']').length>0){return_text+=$('input[name=title'+i+']').val();return_text+='#'+$('input[name=url'+i+']').val();return_text+='#'+$('select[name=target'+i+']').val();return_text+='#'+$('input[name=fa'+i+']').val();if(i<nav_count-1){return_text+='\n'}}}$('textarea[name=option_nav]').val(return_text)}$('#yoniu-setting').removeClass('show')});function deleteLink(id){$('li[data-id='+id+']').remove()}function setForm(){link_count=0;var link_array=link_text.split('\n');$('form[name=setting]').empty();link_array.forEach(function(val,int){array=val.split('+');if(array.length==1){$('form[name=setting]').append('<li data-id="'+int+'"><input type="text" name="title'+int+'"/><svg t="1621246843640" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6437" width="200" height="200"><path d="M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z" p-id="6438"></path></svg></li>');$('input[name=title'+int+']').val($.trim(array[0]))}else{$('form[name=setting]').append('<li data-id="'+int+'"><input type="text" name="title'+int+'" placeholder="链接标题"/><input type="text" name="des'+int+'" placeholder="链接描述"/><input type="text" name="url'+int+'" placeholder="链接"/><input type="text" name="avatar'+int+'" placeholder="头像链接"/><select name="show'+int+'"><option value ="true">首页显示</option><option value ="false">首页不显示</option></select><svg t="1621246843640" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6437" width="200" height="200"><path d="M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z" p-id="6438"></path></svg></li>');$('input[name=title'+int+']').val($.trim(array[0]));$('input[name=des'+int+']').val($.trim(array[2]));$('input[name=url'+int+']').val($.trim(array[1]));if(array.length>=5){$('input[name=avatar'+int+']').val($.trim(array[4]))}$('select[name=show'+int+']').val($.trim(array[3]))}link_count++});$('li[data-id] svg').click(function(){deleteLink($(this).parent().data('id'))})}function setNavForm(){nav_count=0;var nav_array=nav_text.split('\n');$('form[name=setting]').empty();nav_array.forEach(function(val,int){array=val.split('#');$('form[name=setting]').append('<li data-id="'+int+'"><input type="text" name="title'+int+'" placeholder="链接标题"/><input type="text" name="url'+int+'" placeholder="链接"/><input type="text" name="fa'+int+'" placeholder="fa图标名"/><select name="target'+int+'"><option value ="true">新窗口打开</option><option value ="false">非新窗口打开</option></select><svg t="1621246843640" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6437" width="200" height="200"><path d="M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z" p-id="6438"></path></svg></li>');$('input[name=title'+int+']').val($.trim(array[0]));$('input[name=url'+int+']').val($.trim(array[1]));$('select[name=target'+int+']').val($.trim(array[2]));$('input[name=fa'+int+']').val($.trim(array[3]));nav_count++});$('li[data-id] svg').click(function(){deleteLink($(this).parent().data('id'))})}});